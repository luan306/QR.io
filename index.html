<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω t√†i s·∫£n</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">

  <!-- HEADER -->
  <header class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4 flex justify-between items-center shadow-md">
    <div class="flex items-center space-x-2">
      <img src="https://cdn-icons-png.flaticon.com/512/1041/1041882.png" alt="Logo" class="w-8 h-8">
      <span class="font-bold text-lg">Asset Manager</span>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="flex-1 p-4 overflow-y-auto">
    <!-- TAB SCANNER -->
    <section id="tab-scan" class="tab text-center">
      <h2 class="text-xl font-bold mb-4 text-indigo-600">üì∑ Qu√©t m√£ QR</h2>

      <div class="flex justify-center relative">
        <div id="reader" class="rounded-2xl overflow-hidden shadow-lg"
             style="width:100%; max-width:400px; height:320px;"></div>

        <!-- Overlay iOS style -->
        <div class="absolute top-0 left-0 w-full h-full flex items-center justify-center pointer-events-none">
          <div class="relative w-64 h-64">
            <div class="absolute inset-0 bg-black bg-opacity-60"></div>
            <div class="absolute inset-0 m-auto w-60 h-60 border-4 border-white rounded-lg"
                 style="box-shadow: 0 0 0 100vmax rgba(0,0,0,0.6);"></div>
          </div>
        </div>
      </div>

      <div id="scan-result" class="mt-4 text-center text-gray-700"></div>

      <div class="mt-4 flex justify-center space-x-4">
        <button onclick="startScanner()" 
          class="px-6 py-3 bg-indigo-600 text-white rounded-xl shadow hover:bg-indigo-700">
          ‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu qu√©t
        </button>
        <button onclick="stopScanner()" 
          class="px-6 py-3 bg-red-500 text-white rounded-xl shadow hover:bg-red-600">
          ‚èπ Ng·ª´ng qu√©t
        </button>
      </div>
    </section>

    <!-- TAB INVENTORY -->
    <section id="tab-inventory" class="tab hidden">
      <h2 class="text-xl font-bold mb-4 text-indigo-600">üìã Danh s√°ch t√†i s·∫£n</h2>
      <input id="search" type="text" placeholder="üîç T√¨m ki·∫øm thi·∫øt b·ªã..."
             class="w-full p-3 rounded-xl border shadow focus:outline-none focus:ring-2 focus:ring-indigo-400 mb-4">

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div id="stats" class="col-span-2 grid grid-cols-2 gap-4"></div>
        <div class="bg-green-100 p-3 rounded-xl shadow text-center col-span-2 cursor-pointer hover:bg-green-200"
             onclick="showScannedDevices()">
          <div class="font-bold text-green-600">ƒê√£ qu√©t</div>
          <div id="scanned-count" class="text-lg">0 thi·∫øt b·ªã</div>
        </div>
      </div>

      <div id="inventory-list" class="space-y-4"></div>
    </section>

    <!-- TAB ADD -->
    <section id="tab-add" class="tab hidden">
      <h2 class="text-xl font-bold mb-4 text-indigo-600">‚ûï Th√™m thi·∫øt b·ªã m·ªõi</h2>
      <form id="add-form" class="space-y-4">
        <input name="qr" type="text" placeholder="M√£ QR" required class="w-full p-3 rounded-xl border shadow">
        <input name="name" type="text" placeholder="T√™n thi·∫øt b·ªã" required class="w-full p-3 rounded-xl border shadow">
        <input name="dept" type="text" placeholder="B·ªô ph·∫≠n" required class="w-full p-3 rounded-xl border shadow">
        <input name="note" type="text" placeholder="Ghi ch√∫" class="w-full p-3 rounded-xl border shadow">
        <button type="submit" class="w-full bg-green-500 text-white p-3 rounded-xl shadow hover:bg-green-600">
          L∆∞u thi·∫øt b·ªã
        </button>
      </form>
    </section>
  </main>

  <!-- NAVIGATION -->
  <nav class="bg-white shadow-inner border-t flex justify-around py-2">
    <button onclick="showTab('tab-scan')" class="nav-btn flex flex-col items-center text-indigo-600">
      <i class="ri-qr-code-line text-2xl"></i>
      <span class="text-sm">Qu√©t QR</span>
    </button>
    <button onclick="showTab('tab-inventory')" class="nav-btn flex flex-col items-center text-gray-500">
      <i class="ri-file-list-3-line text-2xl"></i>
      <span class="text-sm">Ki·ªÉm k√™</span>
    </button>
    <button onclick="showTab('tab-add')" class="nav-btn flex flex-col items-center text-gray-500">
      <i class="ri-add-circle-line text-2xl"></i>
      <span class="text-sm">Th√™m</span>
    </button>
  </nav>

  <script>
    let qrScanner = null;
    let assets = [
      { qr: "LAP12345", name: "Laptop Dell XPS 13", dept: "IT", status: "Ho·∫°t ƒë·ªông", note: "Ph√≤ng IT-101", scanned: false },
      { qr: "PRN23456", name: "M√°y in Canon LBP2900", dept: "VƒÉn ph√≤ng", status: "H·ªèng", note: "Ph√≤ng vƒÉn ph√≤ng", scanned: false },
      { qr: "MON33333", name: "M√†n h√¨nh Samsung 24\"", dept: "IT", status: "Ho·∫°t ƒë·ªông", note: "Kho IT", scanned: false }
    ];

    function showTab(tabId) {
      document.querySelectorAll(".tab").forEach(tab => tab.classList.add("hidden"));
      document.getElementById(tabId).classList.remove("hidden");
      if (tabId === "tab-inventory") renderInventory();
    }

    async function startScanner() {
      if (qrScanner) {
        await qrScanner.stop().catch(()=>{});
        await qrScanner.clear().catch(()=>{});
      }
      qrScanner = new Html5Qrcode("reader");
      qrScanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: { width: 250, height: 250 } },
        qrCodeMessage => {
          document.getElementById("scan-result").innerText = "‚úÖ K·∫øt qu·∫£: " + qrCodeMessage;
          const item = assets.find(a => a.qr === qrCodeMessage);
          if (item) {
            item.scanned = true;
            renderInventory();
            alert("üéâ ƒê√£ qu√©t: " + item.name);
          } else {
            alert("‚ö†Ô∏è QR kh√¥ng kh·ªõp thi·∫øt b·ªã n√†o!");
          }
          stopScanner();
        }
      ).catch(err => {
        document.getElementById("scan-result").innerText = "‚ùå L·ªói: " + err;
      });
    }

    async function stopScanner() {
      if (qrScanner) {
        await qrScanner.stop().catch(()=>{});
        await qrScanner.clear().catch(()=>{});
        qrScanner = null;
        document.getElementById("scan-result").innerText = "‚èπ ƒê√£ ng·ª´ng qu√©t";
      }
    }

    function renderInventory() {
      const searchVal = document.getElementById("search").value?.toLowerCase() || "";
      const filtered = assets.filter(a =>
        a.name.toLowerCase().includes(searchVal) ||
        a.qr.toLowerCase().includes(searchVal) ||
        a.dept.toLowerCase().includes(searchVal)
      );

      const stats = {};
      filtered.forEach(a => { stats[a.dept] = (stats[a.dept] || 0) + 1; });
      document.getElementById("stats").innerHTML = Object.entries(stats)
        .map(([dept, count]) => `
          <div class="bg-indigo-100 p-3 rounded-xl shadow text-center">
            <div class="font-bold text-indigo-600">${dept}</div>
            <div class="text-lg">${count} thi·∫øt b·ªã</div>
          </div>
        `).join("");

      const scannedCount = assets.filter(a => a.scanned).length;
      document.getElementById("scanned-count").innerText = scannedCount + " thi·∫øt b·ªã";

      document.getElementById("inventory-list").innerHTML = filtered.map(a => `
        <div class="bg-gradient-to-r from-indigo-500 to-purple-500 text-white p-4 rounded-2xl shadow-md">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-bold">${a.name}</h3>
            <span class="px-3 py-1 rounded-full text-sm ${a.scanned ? 'bg-green-400' : 'bg-red-400'}">
              ${a.scanned ? 'ƒê√£ qu√©t' : 'Ch∆∞a qu√©t'}
            </span>
          </div>
          <p class="text-sm mt-1 opacity-90">M√£ QR: ${a.qr}</p>
          <p class="text-sm opacity-90">B·ªô ph·∫≠n: ${a.dept}</p>
          <p class="text-sm opacity-90">${a.note}</p>
        </div>
      `).join("");
    }

    function showScannedDevices() {
      const scanned = assets.filter(a => a.scanned);
      if (scanned.length === 0) {
        alert("‚ö†Ô∏è Ch∆∞a c√≥ thi·∫øt b·ªã n√†o ƒë∆∞·ª£c qu√©t!");
        return;
      }
      let list = scanned.map(a => `- ${a.name} (${a.qr})`).join("\n");
      alert("üìã Danh s√°ch ƒë√£ qu√©t:\n\n" + list);
    }

    document.getElementById("search").addEventListener("input", renderInventory);

    document.getElementById("add-form").addEventListener("submit", e => {
      e.preventDefault();
      const form = new FormData(e.target);
      assets.push({
        qr: form.get("qr"),
        name: form.get("name"),
        dept: form.get("dept"),
        status: "Ho·∫°t ƒë·ªông",
        note: form.get("note") || "",
        scanned: false
      });
      e.target.reset();
      alert("‚úÖ ƒê√£ th√™m thi·∫øt b·ªã!");
    });
  </script>
</body>
</html>
